<script>
    var passStrengthErrors = {
        0: "<%= __("BACK_SIGNUP_PASS_STRENGTH_0") %>",
        1: "<%= __("BACK_SIGNUP_PASS_STRENGTH_1") %>",
        2: "<%= __("BACK_SIGNUP_PASS_STRENGTH_2") %>",
        3: "<%= __("BACK_SIGNUP_PASS_STRENGTH_3") %>",
        4: "<%= __("BACK_SIGNUP_PASS_STRENGTH_4") %>",
        5: "<%= __("BACK_SIGNUP_PASS_STRENGTH_5") %>",
        6: "<%= __("BACK_SIGNUP_PASS_STRENGTH_6") %>"
    };

    $(".password-test").on("keyup", function (event) {
        validatePassword($(this).val());
    });

    function validatePassword(password) {
        var passwordLabel = document.getElementById("password-error-label");
        var result = owaspPasswordStrengthTest.test(password);

        if (result.failedTests.length > 0 && password !== "") {
            passwordLabel.innerHTML = passStrengthErrors[result.failedTests[0]];
            passwordLabel.style.display = "block";
        } else {
            passwordLabel.style.display = "none";
        }
        setProgress(result);
    }

    function setProgress(result) {
        var progressBar = document.getElementById("password-progress");

        if (result.passedTests.length >= 7) {
            progressBar.style.width = "100%";
            return;
        }
        var progress = 100 - result.failedTests.length * 20;
        if (progress < 40) {
            progressBar.style.backgroundColor = "red";
        } else if (progress < 80) {
            progressBar.style.backgroundColor = "orange";
        } else {
            progressBar.style.backgroundColor = "green";
        }
        progressBar.style.width = progress + "%";
    }
</script>